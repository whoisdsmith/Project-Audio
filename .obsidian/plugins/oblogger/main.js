"use strict";var e=require("obsidian");function t(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{r(s.next(e))}catch(e){o(e)}}function l(e){try{r(s.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}r((s=s.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const i={ALPHABETICAL:"alphabetical",CTIME:"ctime",MTIME:"mtime",TYPE:"type",EXTENSION:"extension"},s=e=>{switch(e){case i.ALPHABETICAL:return"Abc";case i.CTIME:return"Created";case i.MTIME:return"Modified";case i.TYPE:return"Type";case i.EXTENSION:return"Ext";default:return""}},n={RECENTS:"recents",FILES:"files",UNTAGGED:"untagged",DAILIES:"dailies"},o="quietly",a="open",l="copy",r={0:e=>{e&&(e.version=1)},1:e=>{const t=e;t&&(t.vaultVisible=!0,t.clockVisible=!1,t.rxSeparatorVisible=!0,t.otcSeparatorVisible=!0,t.version=2)},2:e=>{const t=e;t&&(t.rxGroups.forEach((e=>{e.logsFolderVisible=[n.DAILIES,n.FILES,n.RECENTS].contains(e.groupName),e.templatesFolderVisible=[n.FILES,n.RECENTS].contains(e.groupName),e.excludedFolders=[]})),t.tagGroups.forEach((e=>{e.logsFolderVisible=!1,e.templatesFolderVisible=!1,e.excludedFolders=[]})),t.version=3)}},d={version:3,avatarVisible:!0,vaultVisible:!0,clockVisible:!1,rxSeparatorVisible:!0,otcSeparatorVisible:!0,recentsCount:10,postLogAction:o,tagGroups:[],loggingPath:"",avatarPath:"",rxGroups:[{groupName:n.DAILIES,collapsedFolders:[],isVisible:!0,sortMethod:i.ALPHABETICAL,sortAscending:!0,logsFolderVisible:!0,templatesFolderVisible:!1,excludedFolders:[]},{groupName:n.FILES,collapsedFolders:[],isVisible:!0,sortMethod:i.TYPE,sortAscending:!0,logsFolderVisible:!0,templatesFolderVisible:!0,excludedFolders:[]},{groupName:n.RECENTS,collapsedFolders:[],isVisible:!0,sortMethod:i.ALPHABETICAL,sortAscending:!0,logsFolderVisible:!0,templatesFolderVisible:!0,excludedFolders:[]},{groupName:n.UNTAGGED,collapsedFolders:[],isVisible:!0,sortMethod:i.ALPHABETICAL,sortAscending:!0,logsFolderVisible:!1,templatesFolderVisible:!1,excludedFolders:[]}],dailiesTag:"daily"};var c;!function(e){e.image="image",e.audio="audio",e.video="video",e.md="md",e.canvas="canvas",e.code="code",e.html="html",e.archive="archive",e.text="text"}(c||(c={}));const h="image",u="file-image",p="file-audio",g="file-video",v="file-type",m="file-json-2",C="folder-archive",f=new Map([["bmp",{type:c.image,icon:h}],["gif",{type:c.image,icon:h}],["heic",{type:c.image,icon:h}],["jpeg",{type:c.image,icon:h}],["jpg",{type:c.image,icon:h}],["png",{type:c.image,icon:h}],["svg",{type:c.image,icon:h}],["tiff",{type:c.image,icon:h}],["webp",{type:c.image,icon:h}],["obj",{type:c.image,icon:u}],["procreate",{type:c.image,icon:u}],["psd",{type:c.image,icon:u}],["usdz",{type:c.image,icon:u}],["xcf",{type:c.image,icon:u}],["3gp",{type:c.audio,icon:p}],["flac",{type:c.audio,icon:p}],["m4a",{type:c.audio,icon:p}],["mp3",{type:c.audio,icon:p}],["oga",{type:c.audio,icon:p}],["ogg",{type:c.audio,icon:p}],["opus",{type:c.audio,icon:p}],["wav",{type:c.audio,icon:p}],["avi",{type:c.video,icon:g}],["hevc",{type:c.video,icon:g}],["mkv",{type:c.video,icon:g}],["mov",{type:c.video,icon:g}],["mp4",{type:c.video,icon:g}],["mpeg",{type:c.video,icon:g}],["mpg",{type:c.video,icon:g}],["ogv",{type:c.video,icon:g}],["webm",{type:c.video,icon:g}],["docx",{type:c.text,icon:v}],["pdf",{type:c.text,icon:v}],["rtf",{type:c.text,icon:v}],["txt",{type:c.text,icon:v}],["md",{type:c.md,icon:"file-text"}],["canvas",{type:c.canvas,icon:"layout-dashboard"}],["css",{type:c.code,icon:m}],["js",{type:c.code,icon:m}],["json",{type:c.code,icon:m}],["ts",{type:c.code,icon:m}],["html",{type:c.html,icon:"file-code"}],["7z",{type:c.archive,icon:C}],["apk",{type:c.archive,icon:C}],["dmg",{type:c.archive,icon:C}],["gz",{type:c.archive,icon:C}],["iso",{type:c.archive,icon:C}],["jar",{type:c.archive,icon:C}],["rar",{type:c.archive,icon:C}],["tar",{type:c.archive,icon:C}],["war",{type:c.archive,icon:C}],["wim",{type:c.archive,icon:C}],["xar",{type:c.archive,icon:C}],["xz",{type:c.archive,icon:C}],["zip",{type:c.archive,icon:C}],["zipx",{type:c.archive,icon:C}]]),b=e=>{var t;return null===(t=f.get(e))||void 0===t?void 0:t.type};function E(e,t){var i,s;return!!(null===(s=null===(i=e.internalPlugins.plugins.bookmarks.instance)||void 0===i?void 0:i.items)||void 0===s?void 0:s.find((e=>"file"===e.type&&e.path===t.path)))}const T=(t,i,s)=>{var n,o;const a=null!==(n=null!=s?s:t.metadataCache.getFileCache(i))&&void 0!==n?n:void 0;return{file:i,maybeMetadata:a,mtime:i.stat.mtime,ctime:i.stat.ctime,path:i.path,basename:i.basename,extension:i.extension,tags:null!==(o=a?e.getAllTags(a):[])&&void 0!==o?o:[],isBookmarked:E(t,i)}},y="collapsed";class F{constructor(e,t,i,s,n,o,a){var l;this.app=e,this.groupName=t,this.folderPath=i,this.folderName=null!==(l=i.split("/").last())&&void 0!==l?l:"",this.showStatusIcon=n,this.sortedFiles=[],this.sortedSubFolders=[],this.collapseChangedCallback=s,this.getGroupIconCallback=o,this.getEmptyMessageCallback=a,this.rootElement=document.createElement("div"),this.rootElement.addClass("folder-holder")}hasFileWithin(e){return this.sortedFiles.contains(e)||this.sortedSubFolders.some((t=>t.hasFileWithin(e)))}getCollapsedFolders(){return(this.isCollapsed()?[this.folderPath]:[]).concat(this.sortedSubFolders.flatMap((e=>e.getCollapsedFolders())))}rebuild(e,t,i){this.rootElement.empty(),this.build(e,t,i,0)}buildTitle(t,i){this.titleContainer=document.createElement("div"),this.titleContainer.addClass("family-title"),this.titleContainer.style.marginLeft=`-${12+17*i}px`,this.titleContainer.style.paddingLeft=16+17*i+"px",this.titleContainer.setAttribute("familyName",this.folderName),this.titleContainer.setAttribute("tag-group-tag",this.groupName);const s=document.createElement("div");s.addClass("family-title-text"),s.setText(this.folderName);const n=document.createElement("div");new e.ExtraButtonComponent(n).setIcon(this.getGroupIconCallback(t)).extraSettingsEl.addClass("child-folder-icon"),this.titleContainer.appendChild(n),this.titleContainer.appendChild(s),this.titleContainer.addEventListener("click",(()=>{this.toggleCollapse(),n.empty(),new e.ExtraButtonComponent(n).setIcon(this.getGroupIconCallback(this.isCollapsed())).extraSettingsEl.addClass("child-folder-icon")}))}build(e,t,i,s){const n=e.contains(this.folderPath);this.buildTitle(n,s-1),this.rootElement.appendChild(this.titleContainer),this.buildContent(e,t,i,s),this.rootElement.appendChild(this.contentContainer),n&&this.setCollapsed(!0,!1)}buildContent(e,t,i,s){if(this.contentContainer=document.createElement("div"),this.contentContainer.addClass("family-content"),0===this.sortedSubFolders.length&&0===this.sortedFiles.length){const e=document.createElement("div");e.addClass("empty-rx-message"),e.setText(this.getEmptyMessageCallback()),this.contentContainer.appendChild(e)}else this.sortedSubFolders.forEach((n=>{n.build(e,t,i,s+1),this.contentContainer.appendChild(n.rootElement)})),this.sortedFiles.forEach((e=>{this.contentContainer.appendChild(this.buildFileElement(e,t,i,s))}))}sortFilesByName(e,t){const i=e.name.toLowerCase(),s=t.name.toLowerCase();return i<s?-1:i>s?1:0}sortFilesByBookmark(e,t){const i=E(this.app,e),s=E(this.app,t);return i&&!s?-1:!i&&s?1:0}buildFileElement(t,i,s,n){var o,a,l,r;const d=this.app.metadataCache.getFileCache(t),c=null==d?void 0:d.frontmatter,h=`${t.path}\n\nLast modified at ${window.moment(t.stat.mtime).format("YYYY-MM-DD HH:mm")}\nCreated at ${window.moment(t.stat.ctime).format("YYYY-MM-DD HH:mm")}`,u=document.createElement("div");u.addClass("child-item"),u.style.marginLeft=`-${12+17*n}px`,u.style.paddingLeft=16+17*n+"px",u.addEventListener("click",(e=>{i(t,e.metaKey||e.ctrlKey)}));const p=document.createElement("div");p.addClass("status-icon"),e.setIcon(p,"circle"),this.showStatusIcon&&d&&0===(null!==(a=null===(o=e.getAllTags(d))||void 0===o?void 0:o.length)&&void 0!==a?a:-1)&&"md"===t.extension&&(p.addClass("visible"),p.ariaLabel="Untagged"),u.appendChild(p),new e.ExtraButtonComponent(u).setIcon(null!==(l=null==c?void 0:c.icon)&&void 0!==l?l:(e=>{var t,i;return null!==(i=null===(t=f.get(e.extension))||void 0===t?void 0:t.icon)&&void 0!==i?i:"file-question"})(t)).setDisabled(!0).extraSettingsEl.addClass("child-item-icon");const g=document.createElement("div");g.addClass("child-item-text"),g.setText(null!==(r=(null==c?void 0:c.alias)||(null==c?void 0:c.aliases))&&void 0!==r?r:t.basename),g.ariaLabel=h,u.appendChild(g);const v=document.createElement("div");if(v.addClass("bookmark-icon"),E(this.app,t)&&(e.setIcon(v,"bookmark"),v.ariaLabel="Bookmarked"),u.appendChild(v),"md"!==t.extension.toLowerCase()){const e=document.createElement("div");e.addClass("nav-file-tag"),e.setText(t.extension.toUpperCase()),u.appendChild(e)}return u.setAttribute("data-path",t.path),s(t,u),u}setCollapsed(e,t){const i=e!==this.isCollapsed();e?(this.titleContainer.addClass(y),this.contentContainer.addClass(y)):(this.titleContainer.removeClass(y),this.contentContainer.removeClass(y)),i&&this.collapseChangedCallback(t)}isCollapsed(){return!(!this.titleContainer||!this.contentContainer)&&(this.titleContainer.hasClass(y)!==this.contentContainer.hasClass(y)&&console.warn("Title and content collapse states are out of sync!"),this.titleContainer.hasClass(y))}toggleCollapse(){this.setCollapsed(!this.isCollapsed(),!0)}addFileToFolder(e,t,i){if(0===t.length)return void this.sortedFiles.push(e);const s=t.split("/"),n=`${i}/${s[0]}`;let o=this.sortedSubFolders.find((e=>e.folderPath===n));o||(o=new F(this.app,this.groupName,n,this.collapseChangedCallback,this.showStatusIcon,this.getGroupIconCallback,this.getEmptyMessageCallback),this.sortedSubFolders.push(o)),o&&o.addFileToFolder(e,s.slice(1).join("/"),n)}}class w extends e.SuggestModal{constructor(i,s,n){super(i),this.scope.register(["Shift"],"Enter",(e=>t(this,void 0,void 0,(function*(){yield this.onChooseSuggestion({folderName:this.inputEl.value,isCreator:!0},e),this.close()})))),this.onSelect=n,this.setPlaceholder("Type a folder"),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"shift ↵",purpose:"to create"},{command:"esc",purpose:"to dismiss"}]),this.allFolders=this.app.vault.getAllLoadedFiles().filter((t=>t instanceof e.TFolder&&!s.contains(t.path))).map((e=>e.path))}getSuggestions(e){const t=this.allFolders.filter((t=>t.toLowerCase().includes(e.toLowerCase()))).sort(((t,i)=>t===e?-1:i===e?1:t<i?-1:i<t?1:0)).map((e=>({folderName:e,isCreator:!1})));return 0===t.length?[{folderName:e,isCreator:!0}]:t}renderSuggestion(e,t){e.isCreator&&e.folderName?t.createEl("div",{text:`Create "${e.folderName}" ...`}):t.createEl("div",{text:e.folderName})}onChooseSuggestion(i,s){return t(this,void 0,void 0,(function*(){if(s.shiftKey||i.isCreator){const t=this.app.vault.getAbstractFileByPath(i.folderName);if(t){if(t instanceof e.TFile)return void new e.Notice(`Path ${i.folderName} already exists as a file. Please choose a different path.`)}else yield this.app.vault.createFolder(i.folderName),new e.Notice(`Created logging folder at "${i.folderName}"`)}new e.Notice(`Changed logging folder to "${i.folderName}"`),this.onSelect(i.folderName)}))}}class S extends F{constructor(e,t,i,s,n,o,a,l,r,d,c,h,u,p,g,v,m){super(e,t,"/",(e=>{n(t,this.getCollapsedFolders(),e)}),o,d,(()=>this.getEmptyMessage())),this.settings=l,this.isMovable=u,this.canCollapseInnerFolders=p,this.canBePinned=g,this.isPinned=m,this.fileClickCallback=i,this.fileAddedCallback=s,this.requestRenderCallback=a,this.saveSettingsCallback=r,this.hideCallback=h,this.moveCallback=c,this.pinCallback=v}addFileToFolder(e,t,i){const s=T(this.app,e);this.renderedFileCaches.push({file:e,state:s}),super.addFileToFolder(e,t,i)}isVisible(){var e,t;return null===(t=null===(e=this.getGroupSetting())||void 0===e?void 0:e.isVisible)||void 0===t||t}getGroupSetting(){var e;return null!==(e=this.settings.rxGroups.find((e=>e.groupName===this.groupName)))&&void 0!==e?e:this.settings.tagGroups.find((e=>e.tag===this.groupName))}requestRender(){this.requestRenderCallback&&this.requestRenderCallback()}getContextMenu(){const i=new e.Menu;this.isMovable&&(i.addItem((e=>e.setTitle("Move up").setIcon("arrow-up").setSection("movement").onClick((()=>{this.moveCallback(!0)})))),i.addItem((e=>e.setTitle("Move down").setIcon("arrow-down").setSection("movement").onClick((()=>{this.moveCallback(!1)}))))),this.canBePinned&&i.addItem((e=>e.setTitle(this.isPinned?"Unpin":"Pin").setIcon(this.isPinned?"pin-off":"pin").setSection("movement").onClick((()=>{this.pinCallback&&this.pinCallback(!this.isPinned)})))),this.canCollapseInnerFolders&&i.addItem((e=>e.setTitle("Collapse inner folders").setIcon("chevrons-down-up").setSection("collapsing").onClick((()=>{this.collapseInnerFolders()}))));const s=this.getGroupSetting();return i.addItem((e=>{e.setTitle("Folder exclusions").setSection("exclusions").setIcon("folder-x");const i=e.setSubmenu();i.addItem((e=>{e.setTitle(((null==s?void 0:s.templatesFolderVisible)?"Hide":"Show")+" templates").setIcon((null==s?void 0:s.templatesFolderVisible)?"eye-off":"eye").setSection("hide").onClick((()=>t(this,void 0,void 0,(function*(){s?(s.templatesFolderVisible=!s.templatesFolderVisible,yield this.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to get group setting for ${this.groupName}`)}))))})),i.addItem((e=>{e.setTitle(((null==s?void 0:s.logsFolderVisible)?"Hide":"Show")+" logs").setIcon((null==s?void 0:s.logsFolderVisible)?"eye-off":"eye").setSection("hide").onClick((()=>t(this,void 0,void 0,(function*(){s?(s.logsFolderVisible=!s.logsFolderVisible,yield this.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to get group setting for ${this.groupName}`)}))))})),null==s||s.excludedFolders.forEach((e=>{i.addItem((i=>{i.setTitle(`Include ${e}`).setIcon("folder-plus").setSection("include").onClick((()=>t(this,void 0,void 0,(function*(){s?(s.excludedFolders.remove(e),yield this.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to get group setting for ${this.groupName}`)}))))}))})),i.addItem((e=>{e.setTitle("Exclude folder").setIcon("folder-x").setSection("exclude").onClick((()=>{var e;new w(this.app,["/"].concat(null!==(e=null==s?void 0:s.excludedFolders)&&void 0!==e?e:[]),(e=>t(this,void 0,void 0,(function*(){(null==s?void 0:s.excludedFolders.contains(e))||(null==s||s.excludedFolders.push(e),yield this.saveSettingsCallback(),this.requestRender())})))).open()}))}))})),i.addItem((e=>e.setTitle(this.getHideText()).setIcon(this.getHideIcon()).setSection("danger").onClick((()=>{this.hideCallback()})).setWarning(!0))),i}collapseInnerFolders(){this.sortedSubFolders.forEach((e=>e.setCollapsed(!0,!0)))}buildPinContainer(){const t=document.createElement("div");return t.addClass("pin"),this.isPinned&&t.addClass("is-pinned"),e.setIcon(t,"chevrons-down"),t}buildTitleSvgHolder(){const t=document.createElement("div");return e.setIcon(t,"chevron-down"),t.addClass("title-chevron"),this.isPinned&&t.addClass("is-pinned"),t.addEventListener("click",(()=>{this.toggleCollapse()})),t.appendChild(this.buildPinContainer()),t}buildTitleTextDiv(){const t=document.createElement("div");t.addClass("text-label");const i=document.createElement("div");e.setIcon(i,this.getTextIcon()),i.addClass("text-icon"),i.ariaLabel=this.getTextIconTooltip();const s=document.createElement("div");return s.addClass("title-text"),s.appendChild(t),s.appendChild(i),s.addEventListener("click",(()=>{this.toggleCollapse()})),t.setText(this.getTitleText().toUpperCase()),t.addEventListener("contextmenu",(e=>{const t=this.getContextMenu();t&&t.showAtMouseEvent(e)})),t.ariaLabel=this.getTitleTooltip(),s}buildPill(){const t=document.createElement("div");t.addClass("title-tag");const i=this.getPillTooltipText();i.length>0&&(t.ariaLabel=i);const s=this.getPillClickHandler();s||t.addClass("wiggle"),t.addEventListener("click",(e=>{e.stopPropagation(),s&&s(e)}));const n=this.getPillIcon();n&&e.setIcon(t,n);const o=document.createElement("div");return o.addClass("tag-label"),o.setText(this.getPillText()),t.appendChild(o),t}buildTitle(){""!==this.folderName&&console.warn(`Unexpected folder name ${this.folderName}`),this.titleContainer=document.createElement("div"),this.titleContainer.addClass("title-container"),this.titleContainer.appendChild(this.buildTitleSvgHolder()),this.titleContainer.appendChild(this.buildTitleTextDiv()),this.titleContainer.appendChild(this.buildPill())}rebuildFileStructure(e){this.sortedFiles=[],this.sortedSubFolders=[],this.renderedFileCaches=[],this.buildFileStructure(e)}highlightFile(e){Array.from(document.getElementsByClassName("child-item")).forEach((t=>{t.getAttribute("data-path")===e.path?t.addClass("active"):t.removeClass("active")}))}frontmattersEqual(e,t){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t)return!1;const i=Object.keys(e),s=Object.keys(t);return i.length===s.length&&!i.some((i=>"position"!==i&&t[i]!==e[i]))}tagsEqual(e,t){return e.length===t.length&&!e.some((e=>!t.contains(e)))}isFileExcluded(e,t){if(!e.parent)return!1;let i=!1;return e.parent.path.split("/").reduce(((e,s)=>{if(i)return"";const n=0===e.length?s:e+"/"+s;return t.contains(n)?(i=!0,""):n}),""),i}shouldFileCauseRender(e,t){var i,s,n;const o=t.contains(e.path),a=this.renderedFileCaches.find((t=>t.file===e.file));if(!a&&!o)return this.wouldBeRendered(e);const l=t.contains(null!==(i=null==a?void 0:a.file.path)&&void 0!==i?i:"");if(o&&(!l||a))return!0;if(!a||o)return!1;if(a.state.basename!==e.basename)return!0;if(a.state.isBookmarked!==e.isBookmarked)return!0;const r=null===(s=a.state.maybeMetadata)||void 0===s?void 0:s.frontmatter,d=null===(n=e.maybeMetadata)||void 0===n?void 0:n.frontmatter;if(!this.frontmattersEqual(r,d))return!0;const c=a.state.tags,h=e.tags;return!this.tagsEqual(c,h)||this.shouldRender(a.state,e)}getTemplatesFolders(){var e,t,i,s,n,o,a;const l=[],r=null!==(s=null===(i=null===(t=null===(e=this.app.internalPlugins.plugins.templates)||void 0===e?void 0:e.instance)||void 0===t?void 0:t.options)||void 0===i?void 0:i.folder)&&void 0!==s?s:"";""!==r&&l.push(r);const d=null!==(a=null===(o=null===(n=this.app.plugins.plugins["templater-obsidian"])||void 0===n?void 0:n.settings)||void 0===o?void 0:o.templates_folder)&&void 0!==a?a:"";return""!==d&&l.push(d),l}render(e,t,i){var s,n;const o=null!==(s=i.collapsedFolders)&&void 0!==s?s:[],a=[...null!==(n=i.excludedFolders)&&void 0!==n?n:[]];i.templatesFolderVisible||a.push(...this.getTemplatesFolders()),!i.logsFolderVisible&&this.settings&&a.push(this.settings.loggingPath),!t&&e.length>0&&!e.some((e=>this.shouldFileCauseRender(e,a)))||(this.rebuildFileStructure(a),this.isVisible()?this.rootElement.removeClass("hidden"):this.rootElement.addClass("hidden"),super.rebuild(o,this.fileClickCallback,this.fileAddedCallback),this.rootElement.setAttribute("group-name",this.groupName),this.rootElement.setAttribute("tag-group-tag",this.groupName),this.rootElement.addClass(this.getContainerClass()),this.contentContainer.removeClass("family-content"),this.contentContainer.addClass("content"))}}class x extends S{constructor(e,t,i,s,n,o,a,l,r,d,c,h){super(e,t,n,o,a,!1,l,r,d,(e=>e?"folder-closed":"folder-open"),s,i,!1,!0,!0,c,h)}wouldBeRendered(t){var i,s,n,o,a;if(!t.maybeMetadata)return!1;const l=null===(i=this.getIsolatedTagMatch())||void 0===i?void 0:i.at(1);return(null!==(a=null===(o=null===(n=null===(s=e.getAllTags(t.maybeMetadata))||void 0===s?void 0:s.map((e=>e.replace("#",""))))||void 0===n?void 0:n.unique())||void 0===o?void 0:o.filter((e=>{if(l)return e.contains(l);{const t=this.groupName.split("/").length;return e.split("/").slice(0,t).join("/")===this.groupName}})).length)&&void 0!==a?a:0)>0}shouldRender(e,t){const s=this.getGroupSetting();switch(null==s?void 0:s.sortMethod){case i.ALPHABETICAL:return e.basename!==t.basename;case i.CTIME:return e.ctime!==t.ctime;case i.MTIME:{const i=(null==s?void 0:s.sortAscending)?this.sortedFiles.last():this.sortedFiles.first();return e.mtime!==t.mtime&&i!==t.file}}return!1}getEmptyMessage(){return""}getHideText(){return"Remove"}getHideIcon(){return"trash"}isVisible(){return!0}getIsolatedTagMatch(){return this.groupName.match("\\.\\.\\./(.*)/\\.\\.\\.")}getTitleText(){var e;const t=this.getIsolatedTagMatch();return t?`${t[1]}`:null!==(e=this.groupName.split("/").last())&&void 0!==e?e:""}getTextIcon(){return this.getIsolatedTagMatch()?"tags":""}getTextIconTooltip(){return this.getIsolatedTagMatch()?"Nested within multiple tags":""}getPillText(){var e,t;return s(null!==(t=null===(e=this.getGroupSetting())||void 0===e?void 0:e.sortMethod)&&void 0!==t?t:i.ALPHABETICAL)}getPillTooltipText(){return"Sort"}getTitleTooltip(){return this.getIsolatedTagMatch()?"Associated tags:\n\n"+Object.keys(this.getAllAssociatedTags([])).sort().map((e=>`#${e}`)).join("\n"):`#${this.groupName}`}getPillIcon(){var e,t;return null===(t=null===(e=this.getGroupSetting())||void 0===e?void 0:e.sortAscending)||void 0===t||t?"down-arrow-with-tail":"up-arrow-with-tail"}getPillClickHandler(){return n=>{const o=new e.Menu,a=e=>t(this,void 0,void 0,(function*(){const t=this.getGroupSetting();void 0!==t?(t.sortMethod===e?t.sortAscending=!t.sortAscending:(t.sortMethod=e,t.sortAscending=!0),yield this.saveSettingsCallback(),this.requestRender()):console.warn("undefined group settings")})),l=(e,t)=>{var i,s;e.onClick((()=>a(t))),t===(null===(i=this.getGroupSetting())||void 0===i?void 0:i.sortMethod)?(e.iconEl.addClass("untagged-sort-confirmation"),e.setIcon((null===(s=this.getGroupSetting())||void 0===s?void 0:s.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail")):e.setIcon("down-arrow-with-tail")};[i.ALPHABETICAL,i.CTIME,i.MTIME].forEach((e=>{o.addItem((t=>{t.setTitle(s(e)),l(t,e)}))})),o.showAtMouseEvent(n)}}getFileTags(t,i,s){var n,o,a;if(this.isFileExcluded(t,i))return null;const l=this.app.metadataCache.getFileCache(t);if(null===l)return null;const r=null===(a=null===(o=null===(n=e.getAllTags(l))||void 0===n?void 0:n.map((e=>e.replace("#",""))))||void 0===o?void 0:o.unique())||void 0===a?void 0:a.filter((e=>{if(s)return e.contains(s);{const t=this.groupName.split("/").length;return e.split("/").slice(0,t).join("/")===this.groupName}}));return(null==r?void 0:r.length)?{file:t,tags:r}:null}getAllAssociatedTags(e){var t;const i=null===(t=this.getIsolatedTagMatch())||void 0===t?void 0:t.at(1);return this.renderedFileTags=this.app.vault.getMarkdownFiles().map((t=>this.getFileTags(t,e,i))).filter((e=>null!==e)),this.renderedFileTags.reduce(((e,t)=>(t.tags.forEach((i=>{Object.keys(e).contains(i)||(e[i]=[]),e[i].push(t.file)})),e)),{})}getFileSortingFn(e){switch(e){case i.MTIME:return(e,t)=>e.stat.mtime-t.stat.mtime;case i.CTIME:return(e,t)=>e.stat.ctime-t.stat.ctime;case i.ALPHABETICAL:default:return(e,t)=>e.name<t.name?-1:e.name>t.name?1:0}}buildFileStructure(e){var t,s,n,o,a;this.renderedFileTags=[];const l=this.getAllAssociatedTags(e),r=null===(t=this.getIsolatedTagMatch())||void 0===t?void 0:t.at(1),d=null===(n=null===(s=this.getGroupSetting())||void 0===s?void 0:s.sortAscending)||void 0===n||n,c=null!==(a=null===(o=this.getGroupSetting())||void 0===o?void 0:o.sortMethod)&&void 0!==a?a:i.ALPHABETICAL,h=this.getFileSortingFn(c);Object.keys(l).sort(((e,t)=>(c===i.ALPHABETICAL?d?1:-1:1)*(e<t?-1:e>t?1:0))).forEach((e=>{const t=e.replace(this.groupName,"");l[e].sort(((e,t)=>{const i=this.sortFilesByBookmark(e,t);return 0!=i?i:(d?1:-1)*h(e,t)})).forEach((e=>{var i;let s=t.startsWith("/")?t.slice(1):t;r&&(s.endsWith(r)?s=s.replace(r,""):s.contains(r)&&(s=null!==(i=s.split("/").last())&&void 0!==i?i:"")),this.addFileToFolder(e,s.startsWith("/")?s.slice(1):s,"/")}))}))}getContainerClass(){return"otc-child"}}class k extends e.FuzzySuggestModal{constructor(e,t){super(e),this.onSelect=t}getItems(){const e=Object.keys(this.app.metadataCache.getTags()),t=new Set;return e.forEach((i=>{i.split("/").forEach((i=>{e.contains(i)||(i.startsWith("#")&&(i=i.substring(1)),t.add(`.../${i}/...`))}))})),e.concat(Array.from(t))}getItemText(e){return e}onChooseItem(t,i){new e.Notice(`Selected ${t}`);const s=t.startsWith("#")?t.substring(1):t;this.onSelect(s)}}class I extends S{constructor(e,t,i,s,o,a,l,r,d){super(e,n.DAILIES,t,i,s,!1,o,a,l,(e=>e?"folder-closed":"folder-open"),r,d,!0,!0,!1,void 0,!1),this.fileEntryDates=[]}shouldRender(e,t){var i,s;return this.getDailyDate(e.ctime,!0,null===(i=e.maybeMetadata)||void 0===i?void 0:i.frontmatter)!==this.getDailyDate(t.ctime,!0,null===(s=t.maybeMetadata)||void 0===s?void 0:s.frontmatter)}wouldBeRendered(e){return e.tags.contains("#"+this.settings.dailiesTag)}getEmptyMessage(){return`No documents tagged #${this.settings.dailiesTag};`}getHideText(){return"Hide"}getHideIcon(){return"eye-off"}getTitleText(){return"Daily Notes"}getTitleTooltip(){return""}getTextIcon(){return""}getTextIconTooltip(){return""}getPillText(){return"#"+this.settings.dailiesTag}getPillTooltipText(){return"Change default tag associated with dailies"}getPillIcon(){return""}getPillClickHandler(){return i=>{const s=new e.Menu;s.addItem((i=>{i.setTitle("Change daily tag"),i.setIcon("replace"),i.onClick((()=>{new k(this.app,(i=>t(this,void 0,void 0,(function*(){i?(this.settings.dailiesTag=i,this.saveSettingsCallback(),this.requestRender()):new e.Notice("Not setting dailies tag")})))).open()}))})),s.showAtMouseEvent(i)}}getContainerClass(){return"rx-child"}shouldIncludeFile(t,i){var s,n;if(this.isFileExcluded(t,i))return!1;const o=this.app.metadataCache.getFileCache(t);return null!==o&&(null!==(n=null===(s=e.getAllTags(o))||void 0===s?void 0:s.contains("#"+this.settings.dailiesTag))&&void 0!==n&&n)}getDailyDate(t,i,s){var n,o;return e.moment(null!==(o=null!==(n=null==s?void 0:s.day)&&void 0!==n?n:null==s?void 0:s.created)&&void 0!==o?o:t).format(i?"YYYY-MM-DD":"YYYY-MM")}buildFileStructure(t){this.fileEntryDates=[],this.app.vault.getFiles().filter((e=>this.shouldIncludeFile(e,t))).sort(((e,t)=>{const i=this.app.metadataCache.getFileCache(e),s=this.app.metadataCache.getFileCache(t),n=this.getDailyDate(e.stat.ctime,!1,null==i?void 0:i.frontmatter),o=this.getDailyDate(t.stat.ctime,!1,null==s?void 0:s.frontmatter);if(n>o)return-1;if(n<o)return 1;const a=this.sortFilesByBookmark(e,t);if(0!=a)return a;const l=this.getDailyDate(e.stat.ctime,!0,null==i?void 0:i.frontmatter),r=this.getDailyDate(t.stat.ctime,!0,null==s?void 0:s.frontmatter);return l>r?-1:l<r?1:0})).forEach((t=>{const i=this.app.metadataCache.getFileCache(t),s=this.getDailyDate(t.stat.ctime,!0,null==i?void 0:i.frontmatter);this.fileEntryDates.push({file:t,date:s});const n=e.moment(s),o=n.format("YYYY"),a=n.format("MM");this.addFileToFolder(t,`${o}/${a}`,"/")}))}}const A=[5,10,15];class M extends S{constructor(e,t,i,s,o,a,l,r,d){super(e,n.RECENTS,t,i,s,!0,o,a,l,(e=>e?"folder-closed":"folder-open"),r,d,!0,!1,!1,void 0,!1),this.recentsCount=10,this.recentsCount=a.recentsCount}wouldBeRendered(){return!0}shouldRender(e,t){return e.mtime!==t.mtime&&this.sortedFiles.first()!==t.file}getEmptyMessage(){return"No recents"}getHideText(){return"Hide"}getHideIcon(){return"eye-off"}getTitleText(){return"Recents"}getTitleTooltip(){return""}getTextIcon(){return""}getTextIconTooltip(){return""}getPillText(){return`Last ${this.recentsCount}`}getPillTooltipText(){return"Change number of recents"}getPillIcon(){return""}getPillClickHandler(){return t=>{const i=new e.Menu;A.forEach((e=>{i.addItem((t=>{t.setTitle(e.toString()),t.onClick((()=>{this.recentsCount=e,this.requestRender(),this.settings.recentsCount=e,this.saveSettingsCallback()})),t.setIcon(this.recentsCount===e?"check":""),t.iconEl.addClass("oblogger-pill-menu-icon")}))})),i.showAtMouseEvent(t),i.dom.addClass("oblogger-pill-menu")}}getContainerClass(){return"rx-child"}buildFileStructure(e){console.log(e);let t=0;this.app.vault.getFiles().sort(((e,t)=>t.stat.mtime-e.stat.mtime)).forEach((i=>{t>=this.recentsCount||this.isFileExcluded(i,e)||(this.addFileToFolder(i,"","/"),t+=1)}))}}class D extends S{constructor(e,t,i,s,o,a,l,r,d){super(e,n.UNTAGGED,t,i,s,!1,o,a,l,(e=>e?"folder-closed":"folder-open"),r,d,!0,!1,!1,void 0,!1)}wouldBeRendered(e){return 0===e.tags.length}shouldRender(e,t){const s=this.getGroupSetting();switch(null==s?void 0:s.sortMethod){case i.ALPHABETICAL:return e.basename!==t.basename;case i.CTIME:return e.ctime!==t.ctime;case i.MTIME:{const i=(null==s?void 0:s.sortAscending)?this.sortedFiles.last():this.sortedFiles.first();return e.mtime!==t.mtime&&i!==t.file}}return!1}getEmptyMessage(){return"No untagged documents"}getHideText(){return"Hide"}getHideIcon(){return"eye-off"}getTitleText(){return"Untagged"}getTitleTooltip(){return""}getTextIcon(){return""}getTextIconTooltip(){return""}getPillText(){var e,t;return s(null!==(t=null===(e=this.getGroupSetting())||void 0===e?void 0:e.sortMethod)&&void 0!==t?t:i.ALPHABETICAL)}getPillTooltipText(){return"Sort"}getPillIcon(){var e;return(null===(e=this.getGroupSetting())||void 0===e?void 0:e.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail"}getPillClickHandler(){return n=>{const o=new e.Menu,a=e=>t(this,void 0,void 0,(function*(){const t=this.getGroupSetting();void 0!==t&&(t.sortMethod===e?t.sortAscending=!t.sortAscending:(t.sortMethod=e,t.sortAscending=!0),yield this.saveSettingsCallback(),this.requestRender())})),l=(e,t)=>{var i,s;e.onClick((()=>a(t))),t===(null===(i=this.getGroupSetting())||void 0===i?void 0:i.sortMethod)?(e.iconEl.addClass("untagged-sort-confirmation"),e.setIcon((null===(s=this.getGroupSetting())||void 0===s?void 0:s.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail")):e.setIcon("down-arrow-with-tail")};[i.ALPHABETICAL,i.CTIME,i.MTIME].forEach((e=>{o.addItem((t=>{t.setTitle(s(e)),l(t,e)}))})),o.showAtMouseEvent(n)}}getContainerClass(){return"rx-child"}addFileToFolder(e,t,i){this.renderedFiles.push({file:e,mtime:e.stat.mtime,ctime:e.stat.ctime}),super.addFileToFolder(e,t,i)}buildAlphabeticalFileStructure(t,i){t.sort(((e,t)=>{const s=this.sortFilesByBookmark(e,t);return 0!=s?s:(i?1:-1)*this.sortFilesByName(e,t)})).forEach((t=>{var i,s;const n=this.app.metadataCache.getFileCache(t);null!==n&&0===(null!==(s=null===(i=e.getAllTags(n))||void 0===i?void 0:i.length)&&void 0!==s?s:-1)&&this.addFileToFolder(t,"","/")}))}buildDateFileStructure(t,i,s){t.sort(((t,n)=>{const o=s?t.stat.ctime:t.stat.mtime,a=s?n.stat.ctime:n.stat.mtime,l=e.moment(o).format("YYYY-MM"),r=e.moment(a).format("YYYY-MM");if(l<r)return i?1:-1;if(l>r)return i?-1:1;const d=this.sortFilesByBookmark(t,n);return 0!=d?d:(i?1:-1)*(a-o)})).forEach((t=>{if(null===this.app.metadataCache.getFileCache(t))return void console.error("Cache is null after filtering files. This shouldn't happen.");const i=s?t.stat.ctime:t.stat.mtime,n=e.moment(i),o=n.format("YYYY"),a=n.format("MM");this.addFileToFolder(t,`${o}/${a}`,"/")}))}buildFileStructure(t){var s,n,o,a,l,r,d;this.renderedFiles=[];const c=this.app.vault.getFiles().filter((i=>{var s,n;if("md"!==i.extension)return!1;if(this.isFileExcluded(i,t))return!1;const o=this.app.metadataCache.getFileCache(i);return null!==o&&(null!==(n=null===(s=e.getAllTags(o))||void 0===s?void 0:s.length)&&void 0!==n?n:1)<=0}));switch(null===(s=this.getGroupSetting())||void 0===s?void 0:s.sortMethod){case i.ALPHABETICAL:this.buildAlphabeticalFileStructure(c,null===(o=null===(n=this.getGroupSetting())||void 0===n?void 0:n.sortAscending)||void 0===o||o);break;case i.CTIME:this.buildDateFileStructure(c,null===(l=null===(a=this.getGroupSetting())||void 0===a?void 0:a.sortAscending)||void 0===l||l,!0);break;case i.MTIME:this.buildDateFileStructure(c,null===(d=null===(r=this.getGroupSetting())||void 0===r?void 0:r.sortAscending)||void 0===d||d,!1)}}}class L extends S{constructor(e,t,i,s,o,a,l,r,d){super(e,n.FILES,t,i,s,!1,o,a,l,(e=>e?"package":"package-open"),r,d,!0,!0,!1,void 0,!1)}wouldBeRendered(e){return"md"!==e.extension}shouldRender(e,t){var s;switch(null===(s=this.getGroupSetting())||void 0===s?void 0:s.sortMethod){case i.ALPHABETICAL:return e.basename!==t.basename;case i.CTIME:return e.ctime!==t.ctime;case i.MTIME:return e.mtime!==t.mtime;case i.EXTENSION:case i.TYPE:return e.extension!==t.extension}return!1}getEmptyMessage(){return"No special files"}getPillTooltipText(){return"Sort"}getPillIcon(){var e;return(null===(e=this.getGroupSetting())||void 0===e?void 0:e.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail"}getTitleText(){return"Files"}getTitleTooltip(){return""}getTextIcon(){return""}getTextIconTooltip(){return""}getPillText(){var e,t;return s(null!==(t=null===(e=this.getGroupSetting())||void 0===e?void 0:e.sortMethod)&&void 0!==t?t:i.ALPHABETICAL)}getPillClickHandler(){return n=>{const o=new e.Menu,a=e=>t(this,void 0,void 0,(function*(){const t=this.getGroupSetting();void 0!==t&&(t.sortMethod===e?t.sortAscending=!t.sortAscending:(t.sortMethod=e,t.sortAscending=!0),yield this.saveSettingsCallback(),this.requestRender())})),l=(e,t)=>{var i,s;e.onClick((()=>a(t))),t===(null===(i=this.getGroupSetting())||void 0===i?void 0:i.sortMethod)?(e.iconEl.addClass("untagged-sort-confirmation"),e.setIcon((null===(s=this.getGroupSetting())||void 0===s?void 0:s.sortAscending)?"down-arrow-with-tail":"up-arrow-with-tail")):e.setIcon("down-arrow-with-tail")};[i.ALPHABETICAL,i.CTIME,i.MTIME,i.TYPE,i.EXTENSION].forEach((e=>{o.addItem((t=>{t.setTitle(s(e)),l(t,e)}))})),o.showAtMouseEvent(n)}}getContainerClass(){return"rx-child"}getHideText(){return"Hide"}getHideIcon(){return"eye-off"}buildAlphabeticalFileStructure(e,t){e.sort(((e,i)=>{const s=this.sortFilesByBookmark(e,i);return 0!=s?s:(t?1:-1)*this.sortFilesByName(e,i)})).forEach((e=>{this.addFileToFolder(e,"","/")}))}buildDateFileStructure(t,i,s){t.sort(((t,n)=>{const o=s?t.stat.ctime:t.stat.mtime,a=s?n.stat.ctime:n.stat.mtime,l=e.moment(o).format("YYYY-MM"),r=e.moment(a).format("YYYY-MM");if(l<r)return i?1:-1;if(l>r)return i?-1:1;const d=this.sortFilesByBookmark(t,n);return 0!=d?d:(i?1:-1)*(a-o)})).forEach((t=>{if(null===this.app.metadataCache.getFileCache(t))return void console.error("Cache is null after filtering files. This shouldn't happen.");const i=s?t.stat.ctime:t.stat.mtime,n=e.moment(i),o=n.format("YYYY"),a=n.format("MM");this.addFileToFolder(t,`${o}/${a}`,"/")}))}buildExtensionFileStructure(e,t){e.sort(((e,i)=>{if(e.extension!=i.extension)return(t?1:-1)*(e.extension<i.extension?-1:1);const s=this.sortFilesByBookmark(e,i);return 0!=s?s:this.sortFilesByName(e,i)})).forEach((e=>{this.addFileToFolder(e,e.extension,"/")}))}buildTypeFileStructure(e,t){e.sort(((e,i)=>{var s,n;const o=null!==(s=b(e.extension))&&void 0!==s?s:"unknown",a=null!==(n=b(i.extension))&&void 0!==n?n:"unknown";if(o!=a)return(t?1:-1)*(o<a?-1:1);const l=this.sortFilesByBookmark(e,i);return 0!=l?l:this.sortFilesByName(e,i)})).forEach((e=>{var t;this.addFileToFolder(e,null!==(t=b(e.extension))&&void 0!==t?t:"unknown","/")}))}buildFileStructure(e){var t,s,n,o;const a=this.app.vault.getFiles().filter((t=>!this.isFileExcluded(t,e)&&"md"!==t.extension)),l=null===(s=null===(t=this.getGroupSetting())||void 0===t?void 0:t.sortAscending)||void 0===s||s;switch(null!==(o=null===(n=this.getGroupSetting())||void 0===n?void 0:n.sortMethod)&&void 0!==o?o:i.TYPE){case i.ALPHABETICAL:this.buildAlphabeticalFileStructure(a,l);break;case i.CTIME:this.buildDateFileStructure(a,l,!0);break;case i.MTIME:this.buildDateFileStructure(a,l,!1);break;case i.EXTENSION:this.buildExtensionFileStructure(a,l);break;case i.TYPE:default:this.buildTypeFileStructure(a,l)}}}const G=new Set(["png","jpg","jpeg","gif"]);class P extends e.SuggestModal{constructor(t,i){super(t),this.onSelect=i,this.setPlaceholder("Type an image name"),this.setInstructions([{command:"↑↓",purpose:"to navigate"},{command:"↵",purpose:"to select"},{command:"esc",purpose:"to dismiss"}]),this.allImages=this.app.vault.getAllLoadedFiles().filter((t=>t instanceof e.TFile&&G.has(t.extension)))}getSuggestions(t){const i=e.prepareFuzzySearch(t.trim());return this.allImages.filter((e=>i(e.name)))}renderSuggestion(e,t){t.createEl("div",{text:e.name}),t.ariaLabel=e.path}onChooseSuggestion(e){this.onSelect(e)}}function N(e,t,i){const s=document.createElement("div");s.addClass("separator-container"),s.addClass(e);const n=document.createElement("div");return n.addClass("separator"),n.setText(t),n.ariaLabel=i,s.appendChild(n),s}const R="oblogger-view";class V extends e.ItemView{constructor(i,s,n,o){var a;super(i),this.renderTimeout=null,this.fullRender=!0,this.settings=n,this.showLoggerCallbackFn=s,this.otcGroups=[],this.saveSettingsCallback=o,this.lastOpenFile=null!==(a=this.app.workspace.getActiveFile())&&void 0!==a?a:void 0,this.registerEvent(this.app.metadataCache.on("changed",((e,t,i)=>{this.requestRender(T(this.app,e,i))}))),this.registerEvent(this.app.vault.on("create",(()=>{this.requestRender()}))),this.registerEvent(this.app.vault.on("rename",(()=>{this.requestRender()}))),this.registerEvent(this.app.vault.on("delete",(()=>{this.requestRender()}))),this.registerEvent(this.app.workspace.on("file-open",(e=>{e&&(this.lastOpenFile=e,this.highlightLastOpenFile())}))),this.fileClickCallback=(e,t)=>this.app.workspace.getLeaf(t).openFile(e),this.fileAddedCallback=(i,s)=>{s.addEventListener("contextmenu",(s=>{const n=new e.Menu;n.addSeparator(),n.addItem((e=>e.setTitle("Open in new tab").setSection("open").setIcon("lucide-file-plus").onClick((()=>t(this,void 0,void 0,(function*(){return app.workspace.openLinkText(i.path,i.path,"tab")})))))),n.addItem((e=>e.setTitle("Open to the right").setSection("open").setIcon("lucide-separator-vertical").onClick((()=>t(this,void 0,void 0,(function*(){return app.workspace.openLinkText(i.path,i.path,"split")})))))),this.app.workspace.trigger("file-menu",n,i,"file-explorer"),n.addItem((e=>{e.setTitle("Delete").setSection("danger").setIcon("trash").onClick((()=>t(this,void 0,void 0,(function*(){this.app.fileManager.promptForDeletion(i)})))),e.dom.addClass("is-warning")})),n.addItem((e=>e.setTitle("Rename...").setSection("action").setIcon("pencil").onClick((()=>t(this,void 0,void 0,(function*(){this.app.fileManager.promptForFileRename(i)})))))),"screenX"in s?n.showAtPosition({x:s.pageX,y:s.pageY}):n.showAtPosition({x:s.nativeEvent.locationX,y:s.nativeEvent.locationY})}))},this.rxGroupCollapseChangeCallback=(e,t,i)=>{var s;if(!i)return;const n=null===(s=this.settings)||void 0===s?void 0:s.rxGroups.find((t=>t.groupName===e));return n?(n.collapsedFolders=t,this.saveSettingsCallback()):void 0},this.tagGroupCollapseChangedCallback=(t,i,s)=>{var n;if(!s)return;const o=null===(n=this.settings)||void 0===n?void 0:n.tagGroups.find((e=>e.tag===t));if(o)return o.collapsedFolders=i,this.saveSettingsCallback();new e.Notice(`Unable to find tag ${t} to update the collapse for.`)},this.app.workspace.onLayoutReady((()=>{const e=this.app.internalPlugins.getEnabledPluginById("bookmarks");e&&e.on("changed",(()=>{this.requestRender()}))}))}highlightLastOpenFile(){this.rxContainers.concat(this.otcGroups.map((e=>e.container))).forEach((e=>{this.lastOpenFile&&e.highlightFile(this.lastOpenFile)}))}getViewType(){return R}getDisplayText(){return"Oblogger"}getIcon(){return"orbit"}requestRender(e){if(e){const t=this.filesModifiedSinceRender.findIndex((t=>t.file===e.file));t>=0?this.filesModifiedSinceRender[t]=e:this.filesModifiedSinceRender.push(e)}else this.fullRender=!0;this.renderTimeout||(this.renderTimeout=window.setTimeout((()=>{const e=this.fullRender?[]:this.filesModifiedSinceRender;return this.filesModifiedSinceRender=[],this.fullRender=!1,this.renderNow(e)}),100),this.registerInterval(this.renderTimeout))}renderTagGroup(e,t){var i;const s=null===(i=this.settings)||void 0===i?void 0:i.tagGroups.find((t=>t.tag===e.groupName));s?e instanceof x&&e.render(t,!1,s):console.warn(`unable to find settings for tag group ${e.groupName}`)}renderRxGroup(e,t,i){var s;const n=null===(s=this.settings)||void 0===s?void 0:s.rxGroups.find((t=>t.groupName===e));if(!n)return void console.warn(`unable to find settings for rx group ${e}`);const o=this.rxContainers.find((t=>t.groupName===e));o?o.render(t,i,n):console.warn(`unable to find container for rx group ${e}`)}renderDailies(e){this.renderRxGroup(n.DAILIES,e,!1)}renderFiles(e){this.renderRxGroup(n.FILES,e,!1)}renderUntagged(e){this.renderRxGroup(n.UNTAGGED,e,!1)}renderRecents(e){this.renderRxGroup(n.RECENTS,e,!1)}renderNow(e){return t(this,void 0,void 0,(function*(){yield this.renderAvatar(),yield this.renderVault(),this.renderClock(this.clockDiv),this.renderRXSeparator(),this.renderOTCSeparator(),this.renderRecents(e),this.renderDailies(e),this.renderUntagged(e),this.renderFiles(e),this.otcGroups.forEach((t=>this.renderTagGroup(t.container,e))),this.highlightLastOpenFile(),this.renderTimeout=null}))}renderAvatar(){var i,s,n,o,a,l;return t(this,void 0,void 0,(function*(){(null===(i=this.settings)||void 0===i?void 0:i.avatarVisible)?(null===(s=this.greeterContainerDiv)||void 0===s||s.removeClass("hidden"),null===(n=this.greeterDiv)||void 0===n||n.removeClass("no-avatar")):(null===(o=this.greeterContainerDiv)||void 0===o||o.addClass("hidden"),null===(a=this.greeterDiv)||void 0===a||a.addClass("no-avatar"));const t=new Image;if(null===(l=this.settings)||void 0===l?void 0:l.avatarPath){const i=this.app.vault.getAbstractFileByPath(this.settings.avatarPath);i instanceof e.TFile&&(t.src=this.app.vault.getResourcePath(i))}""===t.src&&t.addClass("hidden"),t.addClass("greeter-title-avatar"),this.avatarDiv.empty(),this.avatarDiv.appendChild(t)}))}renderVault(){var e,i,s;return t(this,void 0,void 0,(function*(){(null===(e=this.settings)||void 0===e?void 0:e.vaultVisible)?null===(i=this.vaultNameDiv)||void 0===i||i.removeClass("hidden"):null===(s=this.vaultNameDiv)||void 0===s||s.addClass("hidden"),this.vaultNameDiv.setText(this.app.vault.getName()),this.vaultNameDiv.addClass("greeter-vault-name")}))}renderClock(t){var i,s,n;(null===(i=this.settings)||void 0===i?void 0:i.clockVisible)?null===(s=this.clockDiv)||void 0===s||s.removeClass("hidden"):null===(n=this.clockDiv)||void 0===n||n.addClass("hidden"),t.empty();const o=e.moment(),a=document.createElement("div");a.setText(o.format("YYYY-MM-DD")),a.addClass("date"),t.appendChild(a);const l=document.createElement("div");l.setText(o.format("HH:mm:ss")),l.addClass("time"),t.appendChild(l)}renderRXSeparator(){var e,t,i;(null===(e=this.settings)||void 0===e?void 0:e.rxSeparatorVisible)?null===(t=this.rxSeparatorDiv)||void 0===t||t.removeClass("hidden"):null===(i=this.rxSeparatorDiv)||void 0===i||i.addClass("hidden")}renderOTCSeparator(){var e,t,i;(null===(e=this.settings)||void 0===e?void 0:e.otcSeparatorVisible)?null===(t=this.otcSeparatorDiv)||void 0===t||t.removeClass("hidden"):null===(i=this.otcSeparatorDiv)||void 0===i||i.addClass("hidden")}buildGreeter(){return t(this,void 0,void 0,(function*(){this.greeterDiv=document.createElement("div"),this.greeterDiv.classList.add("greeter");const i=document.createElement("div");i.classList.add("greeter-title"),this.greeterContainerDiv=document.createElement("div"),this.greeterContainerDiv.addClass("greeter-dot-container"),i.appendChild(this.greeterContainerDiv);const s=document.createElement("div");s.addClass("greeter-title-avatar-border"),this.greeterContainerDiv.appendChild(s),this.avatarDiv=document.createElement("div"),yield this.renderAvatar(),this.greeterContainerDiv.appendChild(this.avatarDiv);const n=document.createElement("div");n.addClass("greeter-title-default-avatar"),n.setText(this.app.vault.getName().charAt(0).toUpperCase()),this.greeterContainerDiv.appendChild(n);const o=document.createElement("div");o.addClass("greeter-title-avatar-changer"),o.addEventListener("click",(()=>{new P(this.app,(i=>t(this,void 0,void 0,(function*(){this.settings.avatarPath=i.path,yield this.saveSettingsCallback(),new e.Notice(`Changed avatar image to ${i.path}`),this.requestRender()})))).open()}));const a=document.createElement("div");a.addClass("greeter-title-avatar-changer-label"),a.setText("Change"),o.appendChild(a),this.greeterContainerDiv.appendChild(o),this.greeterDiv.appendChild(i);const l=document.createElement("div");return l.classList.add("greeter-content"),this.greeterDiv.appendChild(l),this.vaultNameDiv=document.createElement("div"),yield this.renderVault(),l.appendChild(this.vaultNameDiv),this.clockDiv=document.createElement("div"),this.clockDiv.addClass("greeter-clock"),l.appendChild(this.clockDiv),this.renderClock(this.clockDiv),this.registerInterval(window.setInterval((()=>{this.renderClock(this.clockDiv)}),1e3)),this.greeterDiv}))}showNewTagModal(){new k(this.app,(e=>t(this,void 0,void 0,(function*(){this.settings.tagGroups||(this.settings.tagGroups=[]),this.settings.tagGroups.push({tag:e,collapsedFolders:[],isPinned:!1,excludedFolders:[],logsFolderVisible:!1,templatesFolderVisible:!1}),yield this.saveSettingsCallback(),this.reloadOtcGroups()})))).open()}buildHeaderInto(i){const s=document.createElement("div");s.addClass("nav-buttons-container"),i.appendChild(s),new e.ButtonComponent(s).setClass("button-bar-button").setIcon("edit").setTooltip("New note").onClick((()=>t(this,void 0,void 0,(function*(){var t,i;const s=this.app.fileManager.getNewFileParent(null!==(i=null===(t=this.app.workspace.getActiveFile())||void 0===t?void 0:t.path)&&void 0!==i?i:""),n=yield this.app.fileManager.createNewMarkdownFile(s);new e.Notice(`Created ${n.path}`),yield this.app.workspace.getLeaf(!1).openFile(n)})))),new e.ButtonComponent(s).setClass("button-bar-button").setIcon("folder-plus").setTooltip("Add a new user tag group").onClick((()=>this.showNewTagModal())),new e.ButtonComponent(s).setClass("button-bar-button").setIcon("form-input").setTooltip("Create a log entry").onClick(this.showLoggerCallbackFn),new e.ButtonComponent(s).setClass("button-bar-button").setIcon("gear").setTooltip("Settings").onClick((i=>{const s=new e.Menu;this.settings&&(s.addItem((e=>{e.setTitle((this.settings.avatarVisible?"Hide":"Show")+" avatar"),e.setIcon(this.settings.avatarVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.avatarVisible=!this.settings.avatarVisible,yield this.saveSettingsCallback(),this.requestRender()})))),s.addItem((e=>{e.setTitle((this.settings.vaultVisible?"Hide":"Show")+" vault name"),e.setIcon(this.settings.vaultVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.vaultVisible=!this.settings.vaultVisible,yield this.saveSettingsCallback(),this.requestRender()}))))})),s.addItem((e=>{e.setTitle((this.settings.clockVisible?"Hide":"Show")+" clock"),e.setIcon(this.settings.clockVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.clockVisible=!this.settings.clockVisible,yield this.saveSettingsCallback(),this.requestRender()}))))})),s.addItem((e=>{e.setTitle((this.settings.rxSeparatorVisible?"Hide":"Show")+" oblogger group separator"),e.setIcon(this.settings.rxSeparatorVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.rxSeparatorVisible=!this.settings.rxSeparatorVisible,yield this.saveSettingsCallback(),this.requestRender()}))))})),s.addItem((e=>{e.setTitle((this.settings.otcSeparatorVisible?"Hide":"Show")+" user group separator"),e.setIcon(this.settings.otcSeparatorVisible?"eye-off":"eye"),e.onClick((()=>t(this,void 0,void 0,(function*(){this.settings.otcSeparatorVisible=!this.settings.otcSeparatorVisible,yield this.saveSettingsCallback(),this.requestRender()}))))}))})),s.addSeparator(),this.settings.rxGroups.forEach((e=>{s.addItem((i=>{const s=e.isVisible;i.setTitle(`${s?"Hide":"Show"} ${e.groupName}`),i.setIcon(s?"eye-off":"eye"),i.onClick((()=>t(this,void 0,void 0,(function*(){e.isVisible=!e.isVisible,yield this.saveSettingsCallback(),this.requestRender()}))))}))})),s.showAtMouseEvent(i))}))}removeOtcGroup(i){var s;return t(this,void 0,void 0,(function*(){const t=this.otcGroups.find((e=>e.tag===i));void 0!==t?t.tag===i?(this.otcGroups.remove(t),t.container.rootElement.remove(),this.settings.tagGroups=null===(s=this.settings)||void 0===s?void 0:s.tagGroups.filter((e=>e.tag!==i)),yield this.saveSettingsCallback(),this.requestRender(),new e.Notice(`"${i}" removed`)):console.debug("Something went wrong, tag group has wrong tag."):new e.Notice("Nothing to delete")}))}moveRxGroup(e,i){return t(this,void 0,void 0,(function*(){if(!this.settings)return;const t=this.settings.rxGroups.findIndex((t=>t.groupName===e));if(-1===t)return void console.warn(`Group ${e} doesn't exist.`);let s=t+(i?-1:1);for(;s>0&&s<this.settings.rxGroups.length&&!this.settings.rxGroups[s].isVisible;)s+=i?-1:1;if(s<0||s>=this.settings.rxGroups.length)return void console.log("Already at "+(i?"top":"bottom"));const n=this.settings.rxGroups[t];this.settings.rxGroups.remove(n),this.settings.rxGroups.splice(s,0,n),yield this.saveSettingsCallback(),this.reloadRxGroups(),this.requestRender()}))}moveOtcGroup(e,i){return t(this,void 0,void 0,(function*(){const t=this.settings.tagGroups.findIndex((t=>t.tag===e));if(-1===t)return void console.warn(`Tag ${e} doesn't exist.`);const s=t+(i?-1:1);if(s<0||s>=this.settings.tagGroups.length)return void console.log("Already at "+(i?"top":"bottom"));const n=this.settings.tagGroups[t];this.settings.tagGroups.remove(n),this.settings.tagGroups.splice(s,0,n),yield this.saveSettingsCallback(),this.reloadOtcGroups(),this.requestRender()}))}pinOtcGroup(i,s){return t(this,void 0,void 0,(function*(){const t=this.settings.tagGroups.find((e=>e.tag===i));void 0!==t?(t.isPinned=s,yield this.saveSettingsCallback(),this.reloadOtcGroups(),this.requestRender()):new e.Notice(`Unable to find tag ${i} to ${s?"pin":"unpin"}`)}))}addOtcGroup(e,i,s){const n=new x(this.app,e,(()=>t(this,void 0,void 0,(function*(){return yield this.removeOtcGroup(e)}))),(t=>this.moveOtcGroup(e,t)),this.fileClickCallback,this.fileAddedCallback,this.tagGroupCollapseChangedCallback,(()=>{this.requestRender()}),this.settings,this.saveSettingsCallback,(t=>this.pinOtcGroup(e,t)),i);this.otcGroups.push({tag:e,container:n}),s.appendChild(n.rootElement),this.requestRender()}reloadOtcGroups(){var e,t,i,s,n,o,a,l;console.log("reloading otc groups"),null===(e=this.otcGroupsDiv)||void 0===e||e.empty(),this.otcGroups=[];const r=(e,t)=>{var i,s,n,o,a,l;const r="\\.\\.\\./(.*)/\\.\\.\\.",d=null!==(s=null===(i=e.tag.match(r))||void 0===i?void 0:i.at(1))&&void 0!==s?s:e.tag,c=null!==(o=null===(n=t.tag.match(r))||void 0===n?void 0:n.at(1))&&void 0!==o?o:t.tag,h=null!==(a=d.split("/").last())&&void 0!==a?a:"",u=null!==(l=c.split("/").last())&&void 0!==l?l:"";return h<u?-1:h>u?1:0};null===(n=null===(s=null===(i=null===(t=this.settings)||void 0===t?void 0:t.tagGroups)||void 0===i?void 0:i.filter((e=>e.isPinned)))||void 0===s?void 0:s.sort(r))||void 0===n||n.forEach((e=>{this.otcGroupsDiv&&this.addOtcGroup(e.tag,!0,this.otcGroupsDiv)})),null===(l=null===(a=null===(o=this.settings.tagGroups)||void 0===o?void 0:o.filter((e=>!e.isPinned)))||void 0===a?void 0:a.sort(r))||void 0===l||l.forEach((e=>{this.otcGroupsDiv&&this.addOtcGroup(e.tag,!1,this.otcGroupsDiv)}))}hideRxGroup(e){return t(this,void 0,void 0,(function*(){const t=this.settings.rxGroups.find((t=>t.groupName===e));t?(t.isVisible=!t.isVisible,yield this.saveSettingsCallback(),this.requestRender()):console.warn(`Unable to find settings for group ${e}`)}))}reloadRxGroups(){var e,t;if(!this.rxGroupsDiv)return;this.rxContainers=[];const i=e=>{const t=(e=>{switch(e){case n.RECENTS:return M;case n.DAILIES:return I;case n.UNTAGGED:return D;case n.FILES:default:return L}})(e);return new t(this.app,this.fileClickCallback,this.fileAddedCallback,this.rxGroupCollapseChangeCallback,(()=>{this.requestRender()}),this.settings,this.saveSettingsCallback,(t=>this.moveRxGroup(e,t)),(()=>this.hideRxGroup(e)))};this.rxContainers=null!==(t=null===(e=this.settings)||void 0===e?void 0:e.rxGroups.map((e=>i(e.groupName))))&&void 0!==t?t:[],this.rxGroupsDiv.empty(),this.rxContainers.forEach((e=>{var t;return null===(t=this.rxGroupsDiv)||void 0===t?void 0:t.appendChild(e.rootElement)}))}buildBodyInto(e){return t(this,void 0,void 0,(function*(){const t=yield this.buildGreeter();e.appendChild(t),this.rxSeparatorDiv=N("rx-separator","oblogger-groups","Built in groups"),e.appendChild(this.rxSeparatorDiv),this.rxGroupsDiv=document.createElement("div"),this.rxGroupsDiv.addClass("rx-groups"),this.reloadRxGroups(),e.appendChild(this.rxGroupsDiv),this.otcSeparatorDiv=N("otc-separator","user-groups","User created tag groups"),e.appendChild(this.otcSeparatorDiv),this.otcGroupsDiv=document.createElement("div"),this.otcGroupsDiv.addClass("otc-groups"),this.reloadOtcGroups(),e.appendChild(this.otcGroupsDiv)}))}onOpen(){return t(this,void 0,void 0,(function*(){this.containerEl.empty();const e=document.createElement("div");e.addClass("oblogger-header"),this.buildHeaderInto(e),this.containerEl.appendChild(e);const t=document.createElement("div");t.addClass("oblogger-content"),yield this.buildBodyInto(t),this.containerEl.appendChild(t),this.requestRender()}))}}const B="CLOSE_OPTION";class $ extends e.PopoverSuggest{constructor(e,t,i,s){super(e),this.app=e,this.parentEl=t,this.values=s.map((e=>String(e))),this.selecting=!1,this.onSelect=i,this.suggestEl.addEventListener("mousedown",(()=>{this.selecting=!0})),this.parentEl.addEventListener("focusout",(()=>{this.selecting||this.close()})),this.parentEl.addEventListener("focusin",(()=>{this.suggestFrom("")}))}renderSuggestion(e,t){e===B?(t.setText("Close..."),t.addClass("hidden-close-choice")):t.setText(e)}selectSuggestion(e,t){e!==B&&this.onSelect(String(e)),this.selecting=!1,this.close()}suggestFrom(t){0===this.values.length&&(this.selecting=!1,this.close()),t=t.trim();const i=e.prepareFuzzySearch(t),s=this.values.filter((e=>i(e)));if(0===s.length)return this.selecting=!1,void this.close();if(this.suggestions.setSuggestions([B].concat(s)),window.screen.availWidth>=500){const e=this.parentEl.getBoundingClientRect();this.suggestEl.style.width=e.width+"px",this.reposition(e)}this.open()}}const H=new Set(["time","day","date","type","cssclass","position"]);class Y extends e.Modal{constructor(e,t,i){super(e),this.settings=t,this.currentPostLogSelection=this.settings.postLogAction,this.logMap=this.gatherLogMap(),this.logFrontmatter={},this.logContent="",this.saveSettingsCallback=i,this.containerEl.addClass("logger")}gatherLogMap(){const t=new Map,i=this.app.vault.getAbstractFileByPath(this.settings.loggingPath);return i instanceof e.TFolder&&i.children.forEach((i=>{var s;i instanceof e.TFolder&&i.children?i.children.forEach((s=>{var n;s instanceof e.TFile&&t.set(i.name,(null!==(n=t.get(i.name))&&void 0!==n?n:[]).concat([s]))})):i instanceof e.TFile?t.set("",(null!==(s=t.get(""))&&void 0!==s?s:[]).concat([i])):console.error(`Unknown file type found in ${i}`)})),t}buildTitleBar(){const i=document.createElement("div");i.addClass("title-bar");const s=document.createElement("div");s.addClass("title-bar-label"),s.ariaLabel="Change logging path";const n=document.createElement("div");n.addClass("title-bar-icon"),e.setIcon(n,"save"),s.appendChild(n);const o=document.createElement("div");o.addClass("title-bar-label-text");const a=()=>{var e;const t=null===(e=this.settings.loggingPath)||void 0===e?void 0:e.split("/").last();return void 0===t?"click here to set log path":this.settings.loggingPath===t||"/"===this.settings.loggingPath?this.settings.loggingPath:`.../${t}`};o.setText(a()),s.appendChild(o),s.addEventListener("click",(()=>{new w(this.app,["/"],(e=>t(this,void 0,void 0,(function*(){this.settings.loggingPath=e,o.setText(a()),this.updateSubmitButtonIsDisabled(),yield this.saveSettingsCallback()})))).open()})),i.appendChild(s);const l=document.createElement("div");return l.addClass("logger-close-button"),e.setIcon(l,"x"),l.addEventListener("click",(()=>{this.close()})),i.appendChild(l),i}buildDateTimeDiv(){const t=document.createElement("div");t.addClass("datetime-section");const i=document.createElement("div");i.addClass("date-section");const s=document.createElement("div");new e.TextComponent(s).setValue(e.moment().format("YYYY-MM-DD")).onChange((e=>this.logFrontmatter.date=e)).setPlaceholder("date").onChanged(),i.appendChild(s),t.appendChild(i);const n=document.createElement("div");n.addClass("time-section");const o=document.createElement("div");return new e.TextComponent(o).onChange((e=>{this.logFrontmatter.time=e})).setValue(e.moment().format("HH:mm:ss")).setPlaceholder("time").onChanged(),n.appendChild(o),t.appendChild(n),t}buildTypeDiv(){const t=document.createElement("div");t.addClass("logger-section");const i=document.createElement("div");i.addClass("field-div"),this.typeInput=new e.TextComponent(i),this.typeInput.setPlaceholder("type");const s=new $(this.app,this.typeInput.inputEl,(e=>{var t,i;null===(t=this.typeInput)||void 0===t||t.setValue(e),null===(i=this.typeInput)||void 0===i||i.onChanged(),this.rebuildFieldsDiv()}),Array.from(this.logMap.keys()).filter((e=>""!==e)));return this.typeInput.onChange((e=>{s.suggestFrom(e),this.logFrontmatter.type=e})),this.typeInput.inputEl.addEventListener("focusout",(()=>{setTimeout((()=>{this.rebuildFieldsDiv()}),100)})),t.appendChild(i),t}buildField(t,i,s,n){const o=document.createElement("div");o.addClass("logger-section"),o.setAttribute("field-key",t);const a=document.createElement("div");a.addClass("field-div");const l=new e.TextComponent(a);let r;if(l.setPlaceholder(t),t in this.logFrontmatter&&(l.setValue(this.logFrontmatter[t]),n[t]=this.logFrontmatter[t]),o.appendChild(a),s){const i=document.createElement("div");i.addClass("new-field-icons"),r=document.createElement("div"),r.addClass("warning-icon"),r.ariaLabel="New fields require content to be saved!",e.setIcon(r,"alert-triangle"),i.appendChild(r);const s=document.createElement("div");s.addClass("trash-icon"),e.setIcon(s,"x-circle"),s.ariaLabel="Remove new field",s.addEventListener("click",(()=>{var e;null===(e=this.fieldsDiv)||void 0===e||e.removeChild(o),delete this.logFrontmatter[t]})),i.appendChild(s),a.appendChild(i)}const d=new $(this.app,l.inputEl,(e=>{l.setValue(e),l.onChanged()}),Array.from(i));return l.onChange((e=>{s&&r&&r.toggleClass("hidden",!!e),d.suggestFrom(e),this.logFrontmatter[t]=e})),{fieldDiv:o,fieldInput:l}}buildFieldsDiv(){var e,t,i;void 0===this.fieldsDiv&&(this.fieldsDiv=document.createElement("div"),this.fieldsDiv.addClass("additional-meta-group"));const s=null!==(t=null===(e=this.typeInput)||void 0===e?void 0:e.getValue())&&void 0!==t?t:"",n=(null!==(i=this.logMap.get(s))&&void 0!==i?i:[]).reduce(((e,t)=>{var i,s;const n=null!==(s=null===(i=this.app.metadataCache.getFileCache(t))||void 0===i?void 0:i.frontmatter)&&void 0!==s?s:{};return Object.keys(n).forEach((t=>{var i;if(H.has(t))return;if(!n[t])return;const s=String(n[t]).trim();s&&e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:new Set).add(s))})),e}),new Map),o={};return["time","day","date","type"].forEach((e=>{e in this.logFrontmatter&&(o[e]=this.logFrontmatter[e])})),n.forEach(((e,t)=>{var i;if(H.has(t))return;const{fieldDiv:s}=this.buildField(t,e,!1,o);null===(i=this.fieldsDiv)||void 0===i||i.appendChild(s)})),this.logFrontmatter=o,this.fieldsDiv}rebuildFieldsDiv(){void 0!==this.fieldsDiv&&this.fieldsDiv.empty(),this.buildFieldsDiv(),this.updateSubmitButtonIsDisabled()}buildFrontmatter(){return`---\n${Object.keys(this.logFrontmatter).map((e=>`"${e}": "${this.logFrontmatter[e].trim()}"`)).concat(['"cssclass": "log-entry"']).join("\n")}\n---`}saveLog(){var i,s,n;return t(this,void 0,void 0,(function*(){this.app.vault.getAbstractFileByPath(this.settings.loggingPath)||(yield this.app.vault.createFolder(this.settings.loggingPath),new e.Notice(`Created logging folder at "${this.settings.loggingPath}"`));const o=null!==(s=null===(i=this.typeInput)||void 0===i?void 0:i.getValue())&&void 0!==s?s:"";if(!o)return void new e.Notice("Unable to log without a type");const a=("/"===this.settings.loggingPath?"":this.settings.loggingPath+"/")+o;if(null===(null!==(n=this.app.vault.getAbstractFileByPath(a))&&void 0!==n?n:yield(()=>t(this,void 0,void 0,(function*(){return yield this.app.vault.createFolder(a),this.app.vault.getAbstractFileByPath(a)})))()))return void new e.Notice(`Something went wrong getting log folder "${a}"`);const l=`${this.buildFrontmatter()}\n\n${this.logContent}`,r=`${this.logFrontmatter.date}_${this.logFrontmatter.time.replaceAll(":",".")}`,d=`${a+"/"+`${""===o?"log":o}_${r}`}.md`;return this.app.vault.create(d,l)}))}submitLog(){var i;return t(this,void 0,void 0,(function*(){if(this.isSubmitButtonDisabled())return;if(!(null===(i=this.typeInput)||void 0===i?void 0:i.getValue()))return;const t=yield this.saveLog();if(void 0!==t){this.settings.postLogAction=this.currentPostLogSelection,yield this.saveSettingsCallback();const i=t.path.split(".").slice(0,-1).join(".");switch(new e.Notice(`Log file created at "${i}"`),this.currentPostLogSelection){case o:break;case a:yield this.app.workspace.getLeaf(!1).openFile(t);break;case l:yield navigator.clipboard.writeText(`[[${i}]]`);break;default:console.error(`Invalid selection: ${this.currentPostLogSelection}`)}}this.close()}))}isSubmitButtonDisabled(){var e,t;return null===(t=null===(e=this.logChoiceContainer)||void 0===e?void 0:e.hasClass("disabled"))||void 0===t||t}updateSubmitButtonIsDisabled(){var e,t,i,s,n;const o=""===(null!==(e=this.settings.loggingPath)&&void 0!==e?e:""),a=""===(null!==(i=null===(t=this.typeInput)||void 0===t?void 0:t.getValue())&&void 0!==i?i:""),l=o||a,r=l?o?"Requires logging path":a?"Requires type":"":"";this.submitButton&&(this.submitButton.ariaLabel=r),l?null===(s=this.logChoiceContainer)||void 0===s||s.addClass("disabled"):null===(n=this.logChoiceContainer)||void 0===n||n.removeClass("disabled")}buildSubmitBarDiv(){const i=document.createElement("div");i.addClass("submit-bar");const s=document.createElement("div");s.addClass("log-button-container"),this.logChoiceContainer=document.createElement("div"),this.logChoiceContainer.addClass("log-choice-container");const n=[[o,"Log quietly"],[a,"Log and open"],[l,"Log and copy"]];this.submitButton=document.createElement("div"),this.submitButton.addClass("log-choice"),this.updateSubmitButtonIsDisabled(),this.submitButton.addEventListener("click",(()=>t(this,void 0,void 0,(function*(){yield this.submitLog()})))),this.logChoiceContainer.appendChild(this.submitButton);const r=document.createElement("div"),d=document.createElement("div");d.addClass("log-chooser"),e.setIcon(d,"chevron-down"),document.addEventListener("click",(e=>{e.composedPath().includes(d)?r.hasClass("hidden")?(r.removeClass("hidden"),r.focus()):r.addClass("hidden"):e.composedPath().includes(r)||r.addClass("hidden")})),this.logChoiceContainer.appendChild(d),s.appendChild(this.logChoiceContainer),r.addClass("log-drop-down"),r.addClass("hidden");const c=new Map;n.forEach((e=>c.set(e[0],document.createElement("div"))));const h=()=>{var t;null===(t=this.submitButton)||void 0===t||t.setText((e=>{for(const t of n)if(t[0]===e)return t[1];return""})(this.currentPostLogSelection)),c.forEach(((t,i)=>{e.setIcon(t,i===this.currentPostLogSelection?"check":"")}))},u=document.createElement("div");return u.addClass("log-drop-down-choices"),n.forEach((e=>{const t=document.createElement("div");t.addClass("log-drop-container"),t.addEventListener("click",(()=>{this.currentPostLogSelection=e[0],r.addClass("hidden"),h()}));const i=document.createElement("div");i.addClass("log-drop-label"),i.setText(e[1]),t.appendChild(i);const s=c.get(e[0]);void 0!==s?(s.addClass("log-drop-icon"),t.appendChild(s),u.appendChild(t)):console.error(`undefined log drop icon for choice: ${e}`)})),r.appendChild(u),h(),s.appendChild(r),i.appendChild(s),i}buildNewFieldInputDiv(){const t=document.createElement("div");t.addClass("field-div");const i=new e.TextComponent(t).setPlaceholder("new label ...");i.inputEl.addClass("new-field-input");const s=()=>{var t,s,n;const o=i.inputEl.value;if(i.setValue(""),o){if(Array.from(null!==(s=null===(t=this.fieldsDiv)||void 0===t?void 0:t.children)&&void 0!==s?s:[]).some((e=>{var t;return(null===(t=e.getAttribute("field-key"))||void 0===t?void 0:t.toLowerCase())===o.toLowerCase()})))return void new e.Notice(`${o} already added`);if(H.has(o.toLowerCase()))return void new e.Notice(`${o} is special and you can't use it, sorry`);{const{fieldDiv:e,fieldInput:t}=this.buildField(o,new Set,!0,{});null===(n=this.fieldsDiv)||void 0===n||n.appendChild(e),t.inputEl.focus()}}},n=document.createElement("div");n.addClass("new-field-icons");const o=document.createElement("div");return o.addClass("add-icon"),o.ariaLabel="Add new field",e.setIcon(o,"plus-circle"),o.addEventListener("click",(()=>{i.setValue(""),i.inputEl.focus()})),n.appendChild(o),t.appendChild(n),i.inputEl.addEventListener("keypress",(e=>{"Enter"===e.key&&s()})),i.inputEl.addEventListener("focusout",(()=>{s()})),t}buildContentDiv(){const t=document.createElement("div");t.addClass("logger-section");const i=document.createElement("div");i.addClass("content-div");const s=new e.TextAreaComponent(i).onChange((e=>this.logContent=e));return s.setPlaceholder("content"),s.onChanged(),t.appendChild(i),t}buildContentSection(){const e=document.createElement("div");return e.addClass("content-section"),e.appendChild(N("metadata","frontmatter","These fields will write to frontmatter")),e.appendChild(this.buildDateTimeDiv()),e.appendChild(this.buildTypeDiv()),e.appendChild(this.buildFieldsDiv()),e.appendChild(this.buildNewFieldInputDiv()),e.appendChild(N("body","body","This field will write to the document body")),e.appendChild(this.buildContentDiv()),e}onOpen(){const e=document.createElement("div");e.addClass("accent-div");const t=document.createElement("div");t.addClass("accent-content"),t.appendChild(this.buildContentSection()),e.appendChild(this.buildTitleBar()),e.appendChild(t),e.appendChild(this.buildSubmitBarDiv()),this.contentEl.appendChild(e)}onClose(){this.contentEl.empty()}}class O extends e.Plugin{getObloggerView(){for(const e of this.app.workspace.getLeavesOfType(R)){const t=e&&e.view;if(t instanceof V)return t}}loadSettings(){var e,i;return t(this,void 0,void 0,(function*(){this.settings=Object.assign({},d,yield this.loadData());let t=!1;for(;(null!==(e=this.settings.version)&&void 0!==e?e:0)<3;){t=!0;const e=null!==(i=this.settings.version)&&void 0!==i?i:0;if(s=e,n=this.settings,Object.keys(r).contains(s.toString())?r[s](n):console.warn(`Unable to upgrade ${s}. No upgrade function defined.`),this.settings.version!=e+1)return void console.warn("Something went wrong upgrading settings.")}var s,n;if(t)return this.saveSettings()}))}saveSettings(){var e;return t(this,void 0,void 0,(function*(){yield this.saveData(this.settings),null===(e=this.getObloggerView())||void 0===e||e.requestRender()}))}runLogger(){new Y(this.app,this.settings,(()=>this.saveSettings())).open()}onload(){return t(this,void 0,void 0,(function*(){yield this.loadSettings(),this.registerView(R,(e=>new V(e,(()=>t(this,void 0,void 0,(function*(){this.runLogger()}))),this.settings,(()=>t(this,void 0,void 0,(function*(){return yield this.saveSettings()})))))),this.addCommand({id:"open-oblogger-log-logger",name:"Oblogger Log Logger...",callback:()=>{this.runLogger()}}),this.addCommand({id:"open-oblogger-side-panel",name:"Open Oblogger...",callback:()=>{this.activateSidePane()}}),this.app.workspace.onLayoutReady((()=>{this.activateSidePane()}))}))}activateSidePane(){return t(this,void 0,void 0,(function*(){this.app.workspace.getActiveViewOfType(V)||(this.app.workspace.detachLeavesOfType(R),yield this.app.workspace.getLeftLeaf(!1).setViewState({type:R,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(R)[0]))}))}}module.exports=O;
